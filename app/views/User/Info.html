{{set . "title" "个人信息"}}
{{template "header.html" .}}
{{template "navigate_bar.html" .}}
<script>
function updateUserInfoPanel(type)
{
  var xmlhttp;  

if (window.XMLHttpRequest)
  {
    // code for IE7+, Firefox, Chrome, Opera, Safari
    xmlhttp=new XMLHttpRequest();
  }
else
  {
    // code for IE6, IE5
    xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  }

  xmlhttp.onreadystatechange=function()
  {    
  if (xmlhttp.readyState==4 && xmlhttp.status==200)
    {       
      // remove disable regardless of exist
      $('#basic').removeClass('active');
      $('#password').removeClass('active');  
      $('#setting').removeClass('active'); 
      $('#extra').removeClass('active'); 
      // set clicked link class to active   
      if (type == "1")
      {
        $('#basic').addClass('active');            
      }
      if (type == "2")
      {       
        $('#password').addClass('active');      
      }
      if (type == "3")
      {       
        $('#setting').addClass('active');      
      }
      if (type == "4")
      {       
        $('#extra').addClass('active');      
      }
      // return result
      document.getElementById("userInfoPanel").innerHTML=xmlhttp.responseText;
    }
  }  
  // Seems xmlhttp.open can not be executed in switch case staement?
  if (type=='1')
  {
    xmlhttp.open("GET","{{url "User.GetBasicInfo" .userInfo.NickName}}", true);    
  }
  if (type=='2')
  {
    xmlhttp.open("GET","{{url "User.SetPassword" .userInfo.NickName}}", true);    
  }
  if (type=='3')
  {
    xmlhttp.open("GET","{{url "User.SetProfile" .userInfo.NickName}}", true);    
  }
  if (type=='4')
  {
    xmlhttp.open("GET","{{url "User.GetExtraProfile" .userInfo.NickName}}", true);    
  }  
xmlhttp.send();
}
</script>

<script type="text/javascript">
  $(document).ready(function() {
  // process the form
  $('#dsadasd').submit(function(event) {
alert("dsfdsf")
alert($('input[name=oringinalPassword]').val())
    // get the form data
    // there are many ways to get this data using jQuery (you can use the class or id also)
    var formData = {
      'oringinalPassword'        : $('input[name=oringinalPassword]').val(),
      'password'       : $('input[name=userInfo.Password]').val(),
      'confirmPassword'  : $('input[name=userInfo.ConfirmPassword]').val()
    };
alert('aaaaaaaaaa')
    // process the form
    $.ajax({
      type    : 'POST', // define the type of HTTP verb we want to use (POST for our form)
      url     : 'process.php', // the url where we want to POST
      data    : formData, // our data object
      dataType  : 'json', // what type of data do we expect back from the server
                        encode          : true
    })
      // using the done promise callback
      .done(function(data) {
        alert('ssssssssssss')

        // log data to the console so we can see
        console.log(data); 

        // here we will handle errors and validation messages
      });

    // stop the form from submitting the normal way and refreshing the page
    event.preventDefault();
  });

});
</script>

<script>
$(document).ready(function() {
  // Attach a submit handler to the form
  $( "#setPasswordForm" ).submit(function( event ) {
    alert("搜索提交")
    // Stop form from submitting normally
    event.preventDefault();
    // Get some values from elements on the page:
    var $form = $( this ),
    oringinalPasswordd = $form.find('input[name=oringinalPassword]').val(),
    passwordd       = $form.find('input[id=userInfo_Password]').val(),
    confirmPasswordd  = $form.find('input[id=userInfo_ConfirmPassword]').val()

    url = $form.attr( "action" );
    // Send the data using post
    alert(oringinalPasswordd)
    alert(passwordd)
    alert(oringinalPasswordd)
    alert(url)
    var posting = $.post( url, { nickName: oringinalPasswordd, password: passwordd, confirmPassword: confirmPasswordd} );
    // Put the results in a div
    posting.done(function( data ) {    
    alert( "返回结果: " + data );  
    var content = $( data ).find( "#content" );
    alert(content)
    $( "#result" ).empty().append($( data ));
   });
  });
});
</script>

<div id="result">
  <div id="content"></div>
</div> 

<div id="content">  
  <div class="container">
    <div class="row">
    	<div class="col-xs-1"></div> 	
    	<div class="col-xs-10">
    	  <div class="panel panel-success">
          <div class="panel-heading"><h3 class="panel-title">个人资料</h3></div>
          <div class="panel-body">  
            <div class="col-md-2"> 
              <ul class="nav nav-pills nav-stacked">
                <li value="1" id="basic" class="active" onclick="updateUserInfoPanel(this.value)"><a>基本信息</a></li>
                {{if .isAuthor}}
                  <li value="3" id="setting" onclick="updateUserInfoPanel(this.value)"><a>信息变更</a></li>
                  <li value="2" id="password" onclick="updateUserInfoPanel(this.value)"><a>密码设置</a></li>
                {{end}}
                <li value="4" id="extra" onclick="updateUserInfoPanel(this.value)"><a>额外资料</a></li>
              </ul>
            </div>  

            <div class="col-md-8">
              <div id="userInfoPanel"> 
                <form id="setPasswordForm" role="form-horizontal" action="{{url "User.PostSetPassword"}}" method="POST">  
      <dl class="dl-horizontal text-success"> 
        <dt>原始密码</dt>
        <dd>      
          {{with $field := field "oringinalPassword" .}} 
          <div class="form-group {{$field.ErrorClass}}">          
            <div class="col-sm-6"> 
              <input type="password" class="form-control" id="{{$field.Id}}" name="{{$field.Name}}" value="{{$field.Flash}}" placeholder="请输入原始密码">       
              {{if $field.Error}} 
              <span class="help-inline">{{$field.Error}}</span> 
              {{end}}         
            </div> 
          </div> 
          {{end}} 
        </dd></br>   
    
        <dt>新密码</dt>
         <dd>      
          {{with $field := field "userInfo.Password" .}} 
          <div class="form-group {{$field.ErrorClass}}">         
            <div class="col-sm-6"> 
              <input type="password" class="form-control" id="{{$field.Id}}" name="{{$field.Name}}" value="{{$field.Flash}}" placeholder="请输入新密码">       
              {{if $field.Error}} 
              <span class="help-inline">{{$field.Error}}</span> 
              {{end}}         
            </div> 
          </div> 
          {{end}} 
        </dd></br>   
    
        <dt>重复新密码</dt>
         <dd>      
          {{with $field := field "userInfo.ConfirmPassword" .}} 
          <div class="form-group {{$field.ErrorClass}}">        
            <div class="col-sm-6"> 
              <input type="password" class="form-control" id="{{$field.Id}}" name="{{$field.Name}}" value="{{$field.Flash}}" placeholder="重复输入新密码">       
              {{if $field.Error}} 
              <span class="help-inline">{{$field.Error}}</span> 
              {{end}}         
            </div> 
          </div> 
          {{end}} 
        </dd></br>   
        
        <dt></dt>  
        <dd>
          <div class="form-group">
            <label class="radio-inline">
              <div class="form-group">
                <button type="submit" class="btn btn-primary" id="submit">保存</button>
              </div>
            </label>         
          </div>  
        </dd>
      </dl>                  
    </form> 

                <dl class="dl-horizontal text-success">
            	    <dt>头像</dt> <dd><img src={{.userInfo.AvatarUrl}} class="img-thumbnail" alt="头像" height="150" width="150"></dd></br>
                  <dt>昵称</dt> <dd>{{.userInfo.NickName}}</dd></br>
                  <dt>笔名</dt> <dd>{{.userInfo.PenName}}</dd></br>
                  <dt>性别</dt> <dd>{{.userInfo.Gender}}</dd></br>
                  <dt>邮箱</dt> <dd>{{.userInfo.Email}}</dd></br>
                  <dt>生日</dt> <dd>{{.userInfo.Birth}}</dd></br>
                  <dt>喜欢的作者</dt> <dd>{{.userInfo.FavoriteAuthor}}</dd></br>
                  <dt>酷爱的书籍</dt> <dd>{{.userInfo.FavoriteBook}}</dd></br>
                  <dt>兴趣爱好</dt> <dd>{{.userInfo.Intrest}}</dd></br>
                  <dt>个人简介</dt> <dd>{{.userInfo.Introduction}}</dd></br>                  
                </dl>
              <div> 
            </div>     
          </div>                       
         </div>  
      </div>
    </div> 
  </div>
 </div>
 
{{template "footer.html" .}}